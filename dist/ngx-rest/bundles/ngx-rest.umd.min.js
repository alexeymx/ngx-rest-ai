!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("util"),require("@angular/router"),require("ngx-cookie"),require("rxjs"),require("date-fns")):"function"==typeof define&&define.amd?define("ngx-rest",["exports","@angular/core","@angular/common/http","rxjs/operators","util","@angular/router","ngx-cookie","rxjs","date-fns"],t):t((e=e||self)["ngx-rest"]={},e.ng.core,e.ng.common.http,e.rxjs.operators,e.util,e.ng.router,e.ngxCookie,e.rxjs,e.dateFns)}(this,(function(e,t,o,r,n,i,a,s,c){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var u=function(){return(u=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};var p={initialize:"initialize",inProgress:"inProgress",completed:"completed"},l=function(){function e(e){this.http=e}return e.humanReadableFormat=function(e){var t=Math.log(e)/Math.log(1e3)|0;return+(e/Math.pow(1e3,t)).toFixed(2)+" "+("kMGTPEZY"[t-1]||"")+"B"},e.calculateSize=function(e){var t=0;return Array.from(e).forEach((function(e){t+=e.size})),t},e.prototype.createFormData=function(e,t,o){var r=t||new FormData;for(var n in e)if(e.hasOwnProperty(n)&&e[n]){var i=o?o+"["+n+"]":n;if(e[n]instanceof Date)r.append(i,e[n].toISOString());else if(e[n]instanceof FileList)for(var a=0;a<e[n].length;a++)r.append(n+"[]",e[n].item(a));else"object"!=typeof e[n]||e[n]instanceof File?r.append(i,e[n]):this.createFormData(e[n],r,i)}return r},e.prototype.upload=function(e,t,i,a){if(e=e.toLowerCase(),-1===["post","put"].indexOf(e))throw new Error('FileUpload: Method "'+e+'" not allow, use "POST" or "PUT"');var s={state:null,files:i,total:0,loaded:0,progress:0},c={};c[a.listParameterName?a.listParameterName:"files"]=i;var l=new o.HttpRequest(e,t,this.createFormData(a.params?u({},c,a.params):c),{reportProgress:!0,headers:new o.HttpHeaders(a.headers?a.headers:{})});return this.http.request(l).pipe(r.map((function(e){switch(e.type){case o.HttpEventType.Sent:s=u({},s,{state:p.initialize});break;case o.HttpEventType.UploadProgress:s=u({},s,{state:e.total!==e.loaded?p.inProgress:p.completed,total:e.total,loaded:e.loaded,progress:Math.round(100*e.loaded/e.total)});break;case o.HttpEventType.Response:s.state!==p.completed&&(s=u({},s,{state:p.completed}))}return s})),r.filter((function(e){return!n.isNullOrUndefined(e)})),r.distinctUntilChanged())},e.prototype.post=function(e,t,o){return this.upload("post",e,t,o)},e.prototype.put=function(e,t,o){return this.upload("put",e,t,o)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:o.HttpClient}]},e}();var d={initialize:"initialize",inProgress:"inProgress",completed:"completed"},h=function(){function e(e){this.http=e}return e.humanReadableFormat=function(e){var t=Math.log(e)/Math.log(1e3)|0;return+(e/Math.pow(1e3,t)).toFixed(2)+" "+("kMGTPEZY"[t-1]||"")+"B"},e.blobSave=function(e,t){if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,e);else{var o=window.URL.createObjectURL(t),r=document.createElement("a");document.body.appendChild(r),r.setAttribute("style","display: none"),r.href=o,r.download=e,r.click(),setTimeout((function(){window.URL.revokeObjectURL(o),document.body.removeChild(r)}),400)}},e.prototype.download=function(t,i,a,s){if(void 0===s&&(s={}),t=t.toLowerCase(),-1===["get","post","put"].indexOf(t))throw new Error('FileDownload: Method "'+t+'" not allow, use "GET", "POST" or "PUT"');var c={state:null,saveAs:a,total:0,loaded:0,progress:0},p=new o.HttpParams,l={reportProgress:!0,headers:new o.HttpHeaders(s.headers||{})};s.params&&Object.keys(s.params).forEach((function(e){p=p.set(e,s.params[e])}));var h="GET"===t?new o.HttpRequest(t,i,u({},l,{responseType:"blob",params:p})):new o.HttpRequest(t,i,s.params||{},u({},l,{responseType:"blob"}));return this.http.request(h).pipe(r.map((function(t){switch(t.type){case o.HttpEventType.Sent:c=u({},c,{state:d.initialize});break;case o.HttpEventType.DownloadProgress:n.isUndefined(t.total)||(c=u({},c,{state:d.inProgress,total:t.total,loaded:t.loaded,progress:Math.round(100*t.loaded/t.total)}));break;case o.HttpEventType.Response:c.state!==d.completed&&(c=u({},c,{state:d.completed}),e.blobSave(a,t.body))}return c})),r.filter((function(e){return!n.isNullOrUndefined(e)})),r.distinctUntilChanged())},e.prototype.get=function(e,t,o){return void 0===o&&(o={}),this.download("get",e,t,o)},e.prototype.post=function(e,t,o){return void 0===o&&(o={}),this.download("post",e,t,o)},e.prototype.put=function(e,t,o){return void 0===o&&(o={}),this.download("put",e,t,o)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:o.HttpClient}]},e}();var f={cookie:"cookie",localStorage:"localStorage",sessionStorage:"sessionStorage"},g=function(){};var m="get",v="post",y="put",k="Delete",w=function(){function e(){}return e.decodeToken=function(e){if(void 0===e&&(e=""),null===e||""===e)return null;var t=e.split(".");if(3!==t.length)return null;var o=this.urlBase64Decode(t[1]);return o?JSON.parse(o):null},e.urlBase64Decode=function(e){var t=e;switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:return null}var o=atob(t);return decodeURIComponent(o)},e}(),b=function(){function e(){this.cache=new Map}return e.prototype.set=function(e,t){this.cache.set(e,t)},e.prototype.get=function(e){return this.cache.has(e)?this.cache.get(e):null},e.prototype.invalidate=function(e){this.cache.has(e)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var S=function(){function e(e,t,o,r,n){this.http=e,this.cookies=t,this.cache=o,this.router=r,this.cancelPending$=new s.Subject,this.baseHeader={"Cache-Control":"no-cache",accept:"application/json",Pragma:"no-cache",Authorization:"","Accept-Language":"*"},this.secureRequest=!1,this.withFilesRequest=!1,this.cachedRequest=!1,this.invalidateCache=!1,this.config={endPoint:"",tokenName:"AuthToken",tokenStorage:f.cookie,secureCookie:!1,mockData:!1,validationTokenUri:"/info",authUri:"/authorize",UnauthorizedRedirectUri:null},n&&this.setConfig(n)}return e.prototype.setConfig=function(e){return this.config=u({},this.config,e),this},e.prototype.getConfig=function(){return this.config},Object.defineProperty(e.prototype,"token",{get:function(){var e="";switch(this.config.tokenStorage){case f.cookie:e=this.cookies.get(this.config.tokenName);break;case f.localStorage:e=localStorage.getItem(this.config.tokenName);break;case f.sessionStorage:e=sessionStorage.getItem(this.config.tokenName);break;default:throw new Error("Invalid Token Storage method")}return e&&void 0!==e?e:""},set:function(e){var t=w.decodeToken(e),o=c.fromUnixTime(t.exp);switch(this.config.tokenStorage){case f.cookie:this.cookies.put(this.config.tokenName,e,{secure:this.config.secureCookie,expires:o});break;case f.localStorage:localStorage.setItem(this.config.tokenName,e);break;case f.sessionStorage:sessionStorage.setItem(this.config.tokenName,e);break;default:throw new Error("Invalid Token Storage method")}},enumerable:!0,configurable:!0}),e.prototype.revoke=function(){switch(this.config.tokenStorage){case f.cookie:this.cookies.removeAll();break;case f.localStorage:localStorage.removeItem(this.config.tokenName);break;case f.sessionStorage:sessionStorage.removeItem(this.config.tokenName);break;default:throw new Error("Invalid Token Storage method")}},e.prototype.authorize=function(e,t){var o=this;return this.post(this.config.authUri,{username:e,password:t}).pipe(r.tap((function(e){o.token=e})))},e.prototype.validateToken=function(e){return this.secured().request(v,e)},e.prototype.deauthorize=function(e){var t=this;return this.secured().request(m,e).pipe(r.tap((function(){t.revoke()})))},e.prototype.isAuthorized=function(){var e=this.token,t=w.decodeToken(e);return null!==t&&!c.isAfter(new Date,c.fromUnixTime(t.exp))},e.prototype.cancelPendingRequests=function(){this.cancelPending$.next(!0)},e.prototype.cached=function(e){return void 0===e&&(e=!1),this.cachedRequest=!0,this.invalidateCache=e,this},e.prototype.secured=function(){return this.secureRequest=!0,this},e.prototype.public=function(){return this.secureRequest=!1,this},e.prototype.get=function(e,t){return this.request(m,e,t)},e.prototype.post=function(e,t,o,r){return void 0===r&&(r={}),this.request(v,e,t,o,r)},e.prototype.put=function(e,t,o,r){return void 0===r&&(r={}),this.request(y,e,t,o,r)},e.prototype.delete=function(e,t,o){return this.request(k,e,t,o)},e.prototype.withFiles=function(){return this.withFilesRequest=!0,this},e.prototype.createFormData=function(e,t,o){var r=t||new FormData;for(var n in e)if(e.hasOwnProperty(n)&&e[n]){var i=o?o+"["+n+"]":n;if(e[n]instanceof Date)r.append(i,e[n].toISOString());else if(e[n]instanceof FileList)for(var a=0;a<e[n].length;a++)r.append(n+"[]",e[n].item(a));else"object"!=typeof e[n]||e[n]instanceof File?r.append(i,e[n]):this.createFormData(e[n],r,i)}return r},e.prototype.buildUrl=function(e){var t=(this.config.mockData?"assets/mock-data":this.config.endPoint.replace(/\/$/,""))+"/"+e.replace(/^\//g,""),o=t.match(/\.([0-9a-z]+)(?:[\?#]|$)/i);return this.config.mockData&&null==o&&(t+=".json"),t},e.prototype.buildHeaders=function(){var e=u({},this.baseHeader);if(this.config.language&&(e["Accept-Language"]=this.config.language),this.secureRequest){var t=this.token;t?e.Authorization="Bearer "+t:console.warn("Executing a secure request without TOKEN. Authorization header will not be set!"),this.secureRequest=!1}return e},e.prototype.request=function(e,t,o,n,i){var a=this;void 0===i&&(i={});var c=Math.floor(2e3*Math.random()+1e3),p=this.buildHeaders(),l=n||"json";this.withFilesRequest&&(o=this.createFormData(o),this.withFilesRequest=!1);var d="";if(this.cachedRequest)if(d=btoa(unescape(encodeURIComponent(e+"_"+t+"_"+(e===m?JSON.stringify(o):"")))),this.invalidateCache)this.cache.invalidate(d);else{var h=this.cache.get(d);if(h)return this.cachedRequest=!1,s.of(h)}var f={body:e===m?{}:o,responseType:l,params:e===m?o:{},headers:p};return this.http.request(this.config.mockData?m:e,this.buildUrl(t),u({},f,i)).pipe(r.takeUntil(this.cancelPending$)).pipe(r.delay(this.config.mockData?c:0)).pipe(r.tap((function(e){a.cachedRequest&&(a.cachedRequest=!1,a.cache.set(d,e))}))).pipe(r.catchError((function(e){return a.config.UnauthorizedRedirectUri&&t!==a.config.authUri&&401===e.status&&(a.router.navigate([a.config.UnauthorizedRedirectUri]).then((function(){})),a.cancelPendingRequests()),s.throwError(e)})))},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:o.HttpClient},{type:a.CookieService},{type:b},{type:i.Router},{type:g,decorators:[{type:t.Optional}]}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(o.HttpClient),t.ɵɵinject(a.CookieService),t.ɵɵinject(b),t.ɵɵinject(i.Router),t.ɵɵinject(g,8))},token:e,providedIn:"root"}),e}();var R=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:g,useValue:t}]}},e.decorators=[{type:t.NgModule,args:[{imports:[o.HttpClientModule,a.CookieModule.forRoot()],providers:[o.HttpClient,a.CookieService,h,l,i.RouterModule]}]}],e}();e.FileDownload=h,e.FileDownloadState=d,e.FileUpload=l,e.FileUploadState=p,e.NgxRestModule=R,e.RestClientService=S,e.RestServiceConfig=g,e.TypeTokenStorage=f,e.ɵa=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-rest.umd.min.js.map