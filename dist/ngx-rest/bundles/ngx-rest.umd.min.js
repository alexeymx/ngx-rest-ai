!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("util"),require("rxjs"),require("date-fns"),require("ngx-cookie"),require("@angular/router")):"function"==typeof define&&define.amd?define("ngx-rest",["exports","@angular/core","@angular/common/http","rxjs/operators","util","rxjs","date-fns","ngx-cookie","@angular/router"],t):t((e=e||self)["ngx-rest"]={},e.ng.core,e.ng.common.http,e.rxjs.operators,e.util,e.rxjs,e.dateFns,e.ngxCookie,e.ng.router)}(this,(function(e,t,o,n,r,i,a,s,c){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var u,p=function(){return(p=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};(u=e.FileUploadState||(e.FileUploadState={})).initialize="initialize",u.inProgress="inProgress",u.completed="completed";var l,d=function(){function i(e){this.http=e}return i.humanReadableFormat=function(e){var t=Math.log(e)/Math.log(1e3)|0;return+(e/Math.pow(1e3,t)).toFixed(2)+" "+("kMGTPEZY"[t-1]||"")+"B"},i.calculateSize=function(e){var t=0;return Array.from(e).forEach((function(e){t+=e.size})),t},i.prototype.createFormData=function(e,t,o){var n=t||new FormData;for(var r in e)if(e.hasOwnProperty(r)&&e[r]){var i=o?o+"["+r+"]":r;if(e[r]instanceof Date)n.append(i,e[r].toISOString());else if(e[r]instanceof FileList)for(var a=0;a<e[r].length;a++)n.append(r+"[]",e[r].item(a));else"object"!=typeof e[r]||e[r]instanceof File?n.append(i,e[r]):this.createFormData(e[r],n,i)}return n},i.prototype.upload=function(t,i,a,s){if(t=t.toLowerCase(),-1===["post","put"].indexOf(t))throw new Error('FileUpload: Method "'+t+'" not allow, use "POST" or "PUT"');var c={state:null,files:a,total:0,loaded:0,progress:0},u={};u[s.listParameterName?s.listParameterName:"files"]=a;var l=new o.HttpRequest(t,i,this.createFormData(s.params?p(p({},u),s.params):u),{reportProgress:!0,headers:new o.HttpHeaders(s.headers?s.headers:{})});return this.http.request(l).pipe(n.map((function(t){switch(t.type){case o.HttpEventType.Sent:c=p(p({},c),{state:e.FileUploadState.initialize});break;case o.HttpEventType.UploadProgress:c=p(p({},c),{state:t.total!==t.loaded?e.FileUploadState.inProgress:e.FileUploadState.completed,total:t.total,loaded:t.loaded,progress:Math.round(100*t.loaded/t.total)});break;case o.HttpEventType.Response:c.state!==e.FileUploadState.completed&&(c=p(p({},c),{state:e.FileUploadState.completed}))}return c})),n.filter((function(e){return!r.isNullOrUndefined(e)})),n.distinctUntilChanged())},i.prototype.post=function(e,t,o){return this.upload("post",e,t,o)},i.prototype.put=function(e,t,o){return this.upload("put",e,t,o)},i.ɵfac=function(e){return new(e||i)(t.ɵɵinject(o.HttpClient))},i.ɵprov=t.ɵɵdefineInjectable({token:i,factory:i.ɵfac}),i}();(l=e.FileDownloadState||(e.FileDownloadState={})).initialize="initialize",l.inProgress="inProgress",l.completed="completed";var f,h=function(){function i(e){this.http=e}return i.humanReadableFormat=function(e){var t=Math.log(e)/Math.log(1e3)|0;return+(e/Math.pow(1e3,t)).toFixed(2)+" "+("kMGTPEZY"[t-1]||"")+"B"},i.blobSave=function(e,t){if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,e);else{var o=window.URL.createObjectURL(t),n=document.createElement("a");document.body.appendChild(n),n.setAttribute("style","display: none"),n.href=o,n.download=e,n.click(),setTimeout((function(){window.URL.revokeObjectURL(o),document.body.removeChild(n)}),400)}},i.prototype.download=function(t,a,s,c){if(void 0===c&&(c={}),t=t.toLowerCase(),-1===["get","post","put"].indexOf(t))throw new Error('FileDownload: Method "'+t+'" not allow, use "GET", "POST" or "PUT"');var u={state:null,saveAs:s,total:0,loaded:0,progress:0},l=new o.HttpParams,d={reportProgress:!0,headers:new o.HttpHeaders(c.headers||{})};c.params&&Object.keys(c.params).forEach((function(e){l=l.set(e,c.params[e])}));var f="GET"===t?new o.HttpRequest(t,a,p(p({},d),{responseType:"blob",params:l})):new o.HttpRequest(t,a,c.params||{},p(p({},d),{responseType:"blob"}));return this.http.request(f).pipe(n.map((function(t){switch(t.type){case o.HttpEventType.Sent:u=p(p({},u),{state:e.FileDownloadState.initialize});break;case o.HttpEventType.DownloadProgress:r.isUndefined(t.total)||(u=p(p({},u),{state:e.FileDownloadState.inProgress,total:t.total,loaded:t.loaded,progress:Math.round(100*t.loaded/t.total)}));break;case o.HttpEventType.Response:u.state!==e.FileDownloadState.completed&&(u=p(p({},u),{state:e.FileDownloadState.completed}),i.blobSave(s,t.body))}return u})),n.filter((function(e){return!r.isNullOrUndefined(e)})),n.distinctUntilChanged())},i.prototype.get=function(e,t,o){return void 0===o&&(o={}),this.download("get",e,t,o)},i.prototype.post=function(e,t,o){return void 0===o&&(o={}),this.download("post",e,t,o)},i.prototype.put=function(e,t,o){return void 0===o&&(o={}),this.download("put",e,t,o)},i.ɵfac=function(e){return new(e||i)(t.ɵɵinject(o.HttpClient))},i.ɵprov=t.ɵɵdefineInjectable({token:i,factory:i.ɵfac}),i}();(f=e.TypeTokenStorage||(e.TypeTokenStorage={})).cookie="cookie",f.localStorage="localStorage",f.sessionStorage="sessionStorage";var g,m=function(){};!function(e){e.Get="get",e.Post="post",e.Put="put",e.Delete="Delete"}(g||(g={}));var k=function(){function e(){}return e.decodeToken=function(e){if(void 0===e&&(e=""),null===e||""===e)return null;var t=e.split(".");if(3!==t.length)return null;var o=this.urlBase64Decode(t[1]);return o?JSON.parse(o):null},e.urlBase64Decode=function(e){var t=e;switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:return null}var o=atob(t);return decodeURIComponent(o)},e}(),v=function(){function r(t,o,n,r){this.http=t,this.cookies=o,this.router=n,this.cancelPending$=new i.Subject,this.baseHeader={"Cache-Control":"no-cache",accept:"application/json",Pragma:"no-cache",Authorization:"","Accept-Language":"*"},this.secureRequest=!1,this.withFilesRequest=!1,this.config={endPoint:"",tokenName:"AuthToken",tokenStorage:e.TypeTokenStorage.cookie,secureCookie:!1,mockData:!1,validationTokenUri:"/info",authUri:"/authenticate",UnauthorizedRedirectUri:null},r&&this.setConfig(r)}return r.prototype.setConfig=function(e){return this.config=p(p({},this.config),e),this},r.prototype.getConfig=function(){return this.config},Object.defineProperty(r.prototype,"token",{get:function(){var t="";switch(this.config.tokenStorage){case e.TypeTokenStorage.cookie:t=this.cookies.get(this.config.tokenName);break;case e.TypeTokenStorage.localStorage:t=localStorage.getItem(this.config.tokenName);break;case e.TypeTokenStorage.sessionStorage:t=sessionStorage.getItem(this.config.tokenName);break;default:throw new Error("Invalid Token Storage method")}return t&&void 0!==t?t:""},set:function(t){var o=k.decodeToken(t),n=a.fromUnixTime(o.exp);switch(this.config.tokenStorage){case e.TypeTokenStorage.cookie:this.cookies.put(this.config.tokenName,t,{secure:this.config.secureCookie,expires:n});break;case e.TypeTokenStorage.localStorage:localStorage.setItem(this.config.tokenName,t);break;case e.TypeTokenStorage.sessionStorage:sessionStorage.setItem(this.config.tokenName,t);break;default:throw new Error("Invalid Token Storage method")}},enumerable:!0,configurable:!0}),r.prototype.revoke=function(){switch(this.config.tokenStorage){case e.TypeTokenStorage.cookie:this.cookies.removeAll();break;case e.TypeTokenStorage.localStorage:localStorage.removeItem(this.config.tokenName);break;case e.TypeTokenStorage.sessionStorage:sessionStorage.removeItem(this.config.tokenName);break;default:throw new Error("Invalid Token Storage method")}},r.prototype.authorize=function(e,t){return this.authenticate(e,t)},r.prototype.authenticate=function(e,t){var o=this;return this.post(this.config.authUri,{username:e,password:t}).pipe(n.tap((function(e){o.token=e})))},r.prototype.validateToken=function(e){return this.secured().request(g.Post,e)},r.prototype.deauthorize=function(e){return this.deauthenticate(e)},r.prototype.deauthenticate=function(e){var t=this;return this.secured().request(g.Get,e).pipe(n.tap((function(){t.revoke()})))},r.prototype.isAuthorized=function(){var e=this.token,t=k.decodeToken(e);return null!==t&&!a.isAfter(new Date,a.fromUnixTime(t.exp))},r.prototype.isAuthenticated=function(){var e=this.token,t=k.decodeToken(e);return null!==t&&!a.isAfter(new Date,a.fromUnixTime(t.exp))},r.prototype.cancelPendingRequests=function(){this.cancelPending$.next(!0)},r.prototype.secured=function(){return this.secureRequest=!0,this},r.prototype.public=function(){return this.secureRequest=!1,this},r.prototype.get=function(e,t){return this.request(g.Get,e,t)},r.prototype.post=function(e,t,o,n){return void 0===n&&(n={}),this.request(g.Post,e,t,o,n)},r.prototype.put=function(e,t,o,n){return void 0===n&&(n={}),this.request(g.Put,e,t,o,n)},r.prototype.delete=function(e,t,o){return this.request(g.Delete,e,t,o)},r.prototype.withFiles=function(){return this.withFilesRequest=!0,this},r.prototype.createFormData=function(e,t,o){var n=t||new FormData;for(var r in e)if(e.hasOwnProperty(r)&&e[r]){var i=o?o+"["+r+"]":r;if(e[r]instanceof Date)n.append(i,e[r].toISOString());else if(e[r]instanceof FileList)for(var a=0;a<e[r].length;a++)n.append(r+"[]",e[r].item(a));else"object"!=typeof e[r]||e[r]instanceof File?n.append(i,e[r]):this.createFormData(e[r],n,i)}return n},r.prototype.buildUrl=function(e){var t=(this.config.mockData?"assets/mock-data":this.config.endPoint.replace(/\/$/,""))+"/"+e.replace(/^\//g,""),o=t.match(/\.([0-9a-z]+)(?:[\?#]|$)/i);return this.config.mockData&&null==o&&(t+=".json"),t},r.prototype.buildHeaders=function(){var e=p({},this.baseHeader);if(this.config.language&&(e["Accept-Language"]=this.config.language),this.secureRequest){var t=this.token;t?e.Authorization="Bearer "+t:console.warn("Executing a secure request without TOKEN. Authorization header will not be set!"),this.secureRequest=!1}return e},r.prototype.request=function(e,t,o,r,a){var s=this;void 0===a&&(a={});var c=Math.floor(2e3*Math.random()+1e3),u=this.buildHeaders(),l=r||"json";this.withFilesRequest&&(o=this.createFormData(o),this.withFilesRequest=!1);var d={body:e===g.Get?{}:o,responseType:l,params:e===g.Get?o:{},headers:u};return this.http.request(this.config.mockData?g.Get:e,this.buildUrl(t),p(p({},d),a)).pipe(n.takeUntil(this.cancelPending$)).pipe(n.delay(this.config.mockData?c:0)).pipe(n.catchError((function(e){return s.config.UnauthenticatedRedirectUri&&t!==s.config.authUri&&401===e.status&&(s.router.navigate([s.config.UnauthenticatedRedirectUri]).then((function(){})),s.cancelPendingRequests()),s.config.UnauthorizedRedirectUri&&t!==s.config.authUri&&403===e.status&&(s.router.navigate([s.config.UnauthorizedRedirectUri]).then((function(){})),s.cancelPendingRequests()),i.throwError(e)})))},r.ɵfac=function(e){return new(e||r)(t.ɵɵinject(o.HttpClient),t.ɵɵinject(s.CookieService),t.ɵɵinject(c.Router),t.ɵɵinject(m,8))},r.ɵprov=t.ɵɵdefineInjectable({token:r,factory:r.ɵfac,providedIn:"root"}),r}(),y=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:m,useValue:t}]}},e.ɵmod=t.ɵɵdefineNgModule({type:e}),e.ɵinj=t.ɵɵdefineInjector({factory:function(t){return new(t||e)},providers:[o.HttpClient,s.CookieService,h,d,c.RouterModule],imports:[[o.HttpClientModule,s.CookieModule.forRoot()]]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(y,{imports:[o.HttpClientModule,s.CookieModule]}),e.FileDownload=h,e.FileUpload=d,e.NgxRestModule=y,e.RestClientService=v,e.RestServiceConfig=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-rest.umd.min.js.map